Para a segunda entrega do aplicativo, foram desenvolvidos os requisitos já elicitados na primeira entrega conforme mostra a Tabela \ref{tab:req}.

\begin{table}[H]
\centering
\caption{Status dos Requisitos elicitados na primeira entrega}
\label{tab:req}
\begin{tabular}{|l|c|}
\hline
\multicolumn{1}{|c|}{\textbf{História}} & \textbf{Desenvolvida?} \\ \hline

\begin{tabular}[l]{@{}l@{}}Eu, como motorista, gostaria de me cadastrar no sistema para\\acessá-lo\end{tabular}                 & Sim                    \\ \hline
\begin{tabular}[l]{@{}l@{}}Eu, como motorista, gostaria de me autenticar no sistema para\\utilizar suas funcionalidades\end{tabular}                 & Sim                    \\ \hline
\begin{tabular}[l]{@{}l@{}}Eu, como motorista, gostaria de ver os postos dentro de uma\\rota para facilitar a minha escolha de posto\end{tabular}                 & Sim                    \\ \hline
\begin{tabular}[l]{@{}l@{}}Eu, como motorista, gostaria de avaliar os preços já existentes\\para colocar preços verdadeiros em cima e falsos em baixo\end{tabular}                 & Não                    \\ \hline
\begin{tabular}[l]{@{}l@{}}Eu, como motorista, gostaria de avaliar o posto onde eu\\abasteci para atribuir uma nota para sua qualidade\end{tabular}                 & Sim                    \\ \hline
\begin{tabular}[l]{@{}l@{}}Eu, como motorista, gostaria de informar se estou ou não\\abastecendo no posto para contribuir com os dados coletados\\pelo aplicativo\end{tabular}                 & Sim                    \\ \hline
\begin{tabular}[l]{@{}l@{}}Eu, como motorista, gostaria de ver uma lista de postos com\\melhor custo/benefício para abastecer no melhor posto para\\mim\end{tabular}                 & Não                    \\ \hline
\begin{tabular}[l]{@{}l@{}}Eu, como motorista, gostaria de ver uma lista com todos os\\postos boicotados para me programar onde abastecer\end{tabular}                 & Não                    \\ \hline
\begin{tabular}[l]{@{}l@{}}Eu, como motorista, gostaria de saber quando eu estou em um\\posto de combustíveis para interagir com ele\end{tabular}                 & Sim                    \\ \hline
\begin{tabular}[l]{@{}l@{}}Eu, como motorista, gostaria de ver as informações do posto\\onde estou, para saber se quero abastecer nele ou não\end{tabular}                & Sim                    \\ \hline
\begin{tabular}[l]{@{}l@{}}Eu, como motorista, gostaria de registrar o preço de gasolina,\\ álcool ou diesel do posto onde eu me encontro\\para que o preço esteja sempre correto\end{tabular}                & Sim                    \\ \hline
\begin{tabular}[l]{@{}l@{}}Eu, como desenvolvedor, desejo mapear os postos de\\combustíveis para que sejam tratados no sistema\end{tabular}                & Sim                    \\ \hline
\begin{tabular}[l]{@{}l@{}}Eu, como motorista, gostaria de editar o meu cadastro para\\manter minhas informações atualizadas\end{tabular}                & Sim                    \\ \hline
\begin{tabular}[l]{@{}l@{}}Eu, como motorista, desejo abrir a rota de um posto de\\combustível com outros softwares de navegação para conseguir\\chegar à ele\end{tabular}                & Sim                    \\ \hline
\begin{tabular}[l]{@{}l@{}}Eu, como administrador, gostaria de me autenticar no sistema\\para ajustar suas configurações básicas\end{tabular}                & Sim                    \\ \hline
\begin{tabular}[l]{@{}l@{}}Eu, como administrador, gostaria de adicionar as bandeiras dos\\postos para facilitar a identificação pelo usuário\end{tabular}                & Sim                    \\ \hline
\begin{tabular}[l]{@{}l@{}}Eu, como administrador, gostaria de alterar as informações dos\\postos cadastrados para garantir a verossimilhança dos dados\\vindos de fontes externas ao sistema\end{tabular}                & Sim                    \\ \hline
\begin{tabular}[l]{@{}l@{}}Eu, como administrador, gostaria de criar um boicote por\\bandeiras para que o boicote seja efetivo diretamente à uma\\bandeira específica\end{tabular}                & Sim                    \\ \hline
\begin{tabular}[l]{@{}l@{}}Eu, como motorista, gostaria de visualizar um gráfico contendo\\os gastos mensais com combustível para controlar melhor meu\\orçamento\end{tabular}                & Sim                    \\ \hline
\begin{tabular}[l]{@{}l@{}}Eu, como motorista, gostaria de visualizar um histórico de\\postos onde passei para controlar melhor os meus gastos\end{tabular}                & Sim                    \\ \hline
\begin{tabular}[l]{@{}l@{}}Eu, como desenvolvedor, gostaria de criar um algoritmo para\\definir quais serão os postos boicotados\end{tabular}                & Sim                    \\ \hline
\end{tabular}
\end{table}

A Figura \ref{img:tela_de_login} mostra a tela de login da aplicação. O login pode ser feito via Facebook, Google ou criando uma conta local.

\begin{figure}[H]
    \centering
    \includegraphics[scale=0.2]{figuras/app_1.jpg}
    \caption[Tela de login]{Tela de login. Fonte: autores}
    \label{img:tela_de_login}
\end{figure}
\pagebreak

Como ilustrado na Figura \ref{img:postos_de_gasolina_proximos}, são mostrados na aplicação todos os postos de com- bustíveis em um raio de 5 km da localização do usuário.

\begin{figure}[H]
    \centering
    \includegraphics[scale=0.2]{figuras/app_2.jpg}
    \caption[Postos de combustíveis próximos]{Postos de combustíveis próximos à localização do usuário. Fonte: autores}
    \label{img:postos_de_gasolina_proximos}
\end{figure}

A Figura \ref{img:chegou-posto-boicotado} mostra uma tela da aplicação assim que se chega em um posto boicotado.

\begin{figure}[H]
    \centering
    \includegraphics[scale=0.2]{figuras/chegou-posto.jpg}
    \caption[Tela de chegada no posto boicotado]{Tela de chegada no posto boicotado. Fonte: autores}
    \label{img:chegou-posto-boicotado}
\end{figure}

Além desses requisitos, foram elicitados as novas histórias que se mostraram imprescindíveis para a aplicação. O status dos requisitos se encontram na Tabela \ref{tab:req-2}

\begin{table}[H]
\centering
\caption{Status dos Requisitos elicitados na segunda entrega}
\label{tab:req-2}
\begin{tabular}{|c|c|}
\hline
\textbf{História} & \textbf{Desenvolvida?} \\ \hline
15                & Sim                    \\ \hline
16                & Sim                    \\ \hline
17                & Sim                    \\ \hline
18                & Sim                    \\ \hline
19                & Sim                    \\ \hline
20                & Sim                    \\ \hline
21                & Sim                    \\ \hline
\end{tabular}
\end{table}

As funcionalidades de administrador se mostraram imprescindíveis para facilitar a identificação dos postos de combustíveis pelo usuário através de ícones, indicando as bandeiras. Durante o segundo período do projeto, observou-se que algumas informações fornecidas pela API do Google possuíam erros. Com o módulo de administração, é possível corrigir esses erros pontuais. Além disso, como a primeira versão do aplicativo que vai para a Play Store não possuirá as funcionalidades que garantirão a qualidade dos dados de preços dos combustíveis, a possibilidade de editar os dados de sugestão de preço manualmente, de forma mais prática, mostrou-se importante. A Figura \ref{img:admin-1} mostra a página inicial do módulo de administração.

\begin{figure}[H]
    \centering
    \includegraphics[scale=0.32]{figuras/admin-1.png}
    \caption[Página inicial do módulo de administração]{Página inicial do módulo de administração. Fonte: autores}
    \label{img:admin-1}
\end{figure}

Observou-se também a importância de manter um controle na aplicação sobre o controle de gastos do motorista e como essa funcionalidade é um diferencial em relação aos aplicativos atuais. A Figura \ref{img:historico-app} ilustra o histórico de postos abastecidos pelo usuário, enquanto a Figura \ref{img:grafico-app} mostra o gráfico de gastos mensais.

\begin{figure}[H]
    \centering
    \includegraphics[scale=0.2]{figuras/historico-app.jpg}
    \caption[Página inicial do módulo de administração]{Página inicial do módulo de administração. Fonte: autores}
    \label{img:historico-app}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[scale=0.2]{figuras/grafico-app.jpg}
    \caption[Página inicial do módulo de administração]{Página inicial do módulo de administração. Fonte: autores}
    \label{img:grafico-app}
\end{figure}
\pagebreak

Com as funcionalidades implementadas, a comunicação dos sistemas desenvolvidos se dá como ilustrado pela Figura \ref{img:comunicacaosistemas}:

\begin{figure}[H]
    \centering
    \includegraphics[scale=0.5]{figuras/comunicacao_sistemas.png}
    \caption[Comunicação entre os sistemas desenvolvidos.]{Comunicação entre os sistemas desenvolvidos. Fonte: autores}
    \label{img:comunicacaosistemas}
\end{figure}

Os dados armazenados em um banco de dados PostgreSQL são transacionados pela interface administradora e pela API. Por sua vez, aplicativo se comunica com a API para acessar, criar e alterar os dados.

O Apêndice \ref{chap:telas} apresenta algumas outras telas da aplicação desenvolvida.

\subsection{Método de decisão de postos boicotados}
Toda semana, serão selecionados postos onde os usuários serão incentivados a não abastecer. Para decidir quais postos serão boicotados, o Guimifiu tem duas estratégias principais: a \textbf{Lista Comum} e o \textbf{Boicote por Bandeiras}. A lista comum escolhe os postos com qualidade geral menor que 1 e que não tenham sido boicotados recentemente, criando uma lista inicial. A qualidade geral de um posto é determinada pela fórmula a seguir, onde são considerados o número de estrelas do posto e o preço dos combustíveis:

\begin{equation}
\label{Equação para cálculo de qualidade geral do Combustível}
	QG = \frac{5*QE}{2*(PG + PA + PD)}
\end{equation}

Sendo que QG é a Qualidade Geral do posto, PG, PA e PD são os preços de Gasolina, Álcool e Diesel, respectivamente e, por fim, QE é a Quantidade de Estrelas. A quantidade de estrelas é definida pela média das avaliações dos usuários. O objetivo é que a qualidade do posto indicado pelos usuários seja proporcional à qualidade geral dele e que os preços dos combustíveis sejam inversamente proporcionais, ou seja, quanto maior a quantidade de estrelas e menor o preço dos combustíveis, maior a qualidade geral do posto, diminuindo suas chances do mesmo ser boicotado. Essa fórmula será balanceada de acordo com os dados dos postos e das avaliações dos usuários com o tempo. A tabela \ref{tab:exemplo} contém um exemplo de postos fictícios com preços, quantidade de estrelas e a qualidade geral.

\begin{table}[H]
\centering
\caption{Tabela de postos fictícios}
\label{tab:exemplo}
\begin{tabular}{|c|c|c|c|c|c|}\hline
\textbf{Posto} & \textbf{PG}   & \textbf{PA}   & \textbf{PD}   & \textbf{QE}  & \textbf{QG}   \\
\hline
1     & 4,00 & 3,00 & 4,00 & 2   & 0,45 \\ \hline
2     & 3,90 & 3,20 & 4,50 & 5   & 1,07 \\ \hline
3     & 4,00 & 3,50 & 3,70 & 4,5 & 1,00 \\ \hline
4     & 4,00 & 3,80 & 3,90 & 3,5 & 0,74 \\ \hline
5     & 4,00 & 3,80 & 3,90 & 4,5 & 0,96 \\ \hline
\end{tabular}
\end{table}

Na tabela \ref{tab:exemplo}, os postos 1, 4 e 5 seriam os colocados na lista inicial, devido ao baixo QG. Os postos 2 e 3 estariam logo acima do limite mínimo e, portanto, estariam de fora da lista.

A lista inicial é montada e então a aplicação verifica se não existem muitos postos próximos sendo boicotados, para não deixar o usuário com poucas opções de locais de abastecimento. Essa verificação é feita através de grafos. Os nós dos grafos são os postos de combustíveis e as arestas são as distâncias entre os todos postos que não sejam maiores que 10 quilômetros. Com este grafo, em cada nó da lista inicial é verificado se os nós adjacentes são todos postos que estão na lista inicial. Em caso positivo, o nó é removido da lista; caso contrário, o nó é mantido. Os nós restantes compõem a lista final de postos boicotados, denominada \textbf{Lista Comum}. Na Figura \ref{img:listainicial}, considerando que os pontos vermelhos são nós da lista inicial e os pontos azuis são os demais postos, após a verificação, os pontos vermelhos virariam azuis, como mostrado na Figura \ref{img:listacomum}.

\begin{figure}[H]
    \centering
    \includegraphics[scale=0.4]{figuras/listainicial.jpg}
    \caption[Grafo com Lista Inicial de Postos Boicotados]{Grafo com Lista Inicial de Postos Boicotados. Fonte: autores}
    \label{img:listainicial}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[scale=0.4]{figuras/listacomum.jpg}
    \caption[Grafo com Lista Comum de Postos Boicotados]{Grafo com Lista Comum de Postos Boicotados. Fonte: autores}
    \label{img:listacomum}
\end{figure}

Baseado no algoritmo, foi desenvolvido um script na linguagem Ruby que é executado semanalmente no servidor hospedado no Heroku, através do \textit{Heroku Scheduler}, uma ferramenta criada para executar tarefas no servidor.

O \textbf{Boicote por Bandeiras} acontece quando todos os postos de uma bandeira previamente selecionada são colocados na lista de boicotados, independentemente da distância entre eles, colocando o prejuízo do boicote menos nos postos e mais na bandeira. Os dois tipos de boicote são exclusivos, ou seja, não ocorrem no mesmo período. A estratégia de boicote é escolhida pela equipe de desenvolvimento. O \textbf{Boicote por Bandeiras} é iniciado manualmente no módulo de administração, como mostra a Figura \ref{img:admin-2}

\begin{figure}[H]
    \centering
    \includegraphics[scale=0.32]{figuras/admin-2.png}
    \caption[Página de criação de Boicotes do módulo de administração]{Página de criação de Boicotes do módulo de administração. Fonte: autores}
    \label{img:admin-2}
\end{figure}

\subsection{Testes Automatizados}

Foram feitos testes de integração e unitários para garantir o funcionamento dos métodos do código-fonte e da integração da aplicação \textit{mobile} com a API.

Encontrou-se uma certa dificuldade pra realizar os testes unitários no Ionic, uma vez que não há muitos exemplos que de fato funcionam e uma documentação do próprio \textit{framework} sobre o assunto.

O código de testes pode ser encontrado no repositório da aplicação no GitHub (https://github.com/Guimifiu/guimifiu-app). Um exemplo de teste unitário e de teste de integração está disponível no Apêndice \ref{chap:testes}.

\subsection{Métricas de Código-fonte}

Como citado no \autoref{chap:met}, foram utilizadas as ferramentas CodeClimate e Rubocop. Além de medir a complexidade no Rubocop, foi feita na integração contínua um relatório de métricas pela ferramenta que impede que a \textit{build} passe caso a complexidade seja maior do que 6, que é o padrão de complexidade ciclomática máxima aceitável.

A Figura \ref{img:rubocop} mostra o resultado da análise feita pelo Rubocop. O arquivo de configuração utilizado para a análise pode ser encontrado no endereço do GitHub do  \citeonline{rubocop-guimifiu}.

\begin{figure}[H]
    \centering
    \includegraphics[scale=0.5]{figuras/rubocop.png}
    \caption[Relatório de análise estática do Rubocop]{Relatório de análise estática do Rubocop. Fonte: autores}
    \label{img:rubocop}
\end{figure}

A Figura \ref{img:codeclimate} mostra o resultado das análises realizado pelo \href{https://codeclimate.com/github/Guimifiu/guimifiu-backend/}{CodeClimate}.

\begin{figure}[H]
    \centering
    \includegraphics[scale=0.5]{figuras/codeclimate.png}
    \caption[Relatório de análise estática do CodeClimate]{Relatório de análise estática do CodeClimate. Fonte: autores}
    \label{img:codeclimate}
\end{figure}

As \textit{issues} encontradas no CodeClimate infelizmente não puderam ser tratadas a tempo da entrega do projeto devido aos problemas encontrados durante o desenvolvimento, como descritos no Capítulo \ref{chap:crono}.


\subsection{Integração e Entrega Contínua}
\input{editaveis/resultados/integracao-e-deploy-continuo}
