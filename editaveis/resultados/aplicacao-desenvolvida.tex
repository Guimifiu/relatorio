\section{Aplicação Desenvolvida}
Para a segunda entrega do aplicativo, foram desenvolvidos os seguintes requisitos já elicitados na primeira entrega:
\begin{itemize}
    \item Eu, como motorista, gostaria de me cadastrar no sistema para ter acesso ao login;
    \item Eu, como motorista, gostaria de logar no sistema para utilizar as funcionalidades do mesmo;
    \item Eu, como motorista, gostaria de ver os postos dentro de uma rota para facilitar a minha escolha de posto;
    \item Eu, como motorista, gostaria de avaliar o posto onde eu abasteci para atribuir uma qualidade ao mesmo;
    \item Eu, como motorista, gostaria de informar se estou ou não abastecendo no posto para contribuir com os dados coletados pelo aplicativo;
    \item Eu, como motorista, gostaria de ver uma lista com todos os postos boicotados para me programar com antecedência em onde abastecer;
    \item Eu, como motorista, gostaria de saber quando eu estou em um posto de combustíveis para interagir com o mesmo;
    \item Eu, como motorista, gostaria de editar o meu cadastro para manter minhas informações atualizadas;
    \item Eu, como motorista, gostaria de registrar o preço de combustíveis, álcool ou diesel do posto onde eu me encontro para ele sempre estar com o preço correto;
    \item Eu, como desenvolvedor, desejo mapear os postos de combustíveis para que sejam tratados no sistema;
    \item Eu, como motorista, gostaria de editar o meu cadastro para manter minhas informações atualizadas;
    \item Eu, como motorista, gostaria de ver as informações do posto onde eu estou, para saber se quero abastecer nele ou não.
\end{itemize}

Além desses requisitos, foram elicitados os seguintes novos itens que se mostraram imprescindíveis para a aplicação:

\begin{itemize}
    \item Eu, como administrador, gostaria de entrar no sistema para ajustar configurações básicas do sistema;
    \item Eu, como administrador, gostaria de adicionar as bandeiras dos postos para facilitar a identificação pelo usuário;
    \item Eu, como administrador, gostaria de alterar as informações dos postos cadastrados para garantir a verossimilhança dos dados vindos de fontes externas ao sistema;
    \item Eu, como motorista, gostaria de visualizar um gráfico contendo os gastos mensais com combustível para controlar melhor o meu orçamento;
    \item Eu, como motorista, gostaria de visualizar um histórico de postos onde passei para controlar melhor os meus gastos.
\end{itemize}

COLOCAR PRINTS DE ALGUMAS TELAS ENTRE ALGUNS ITENS

As funcionalidades de administrador se mostraram imprescindíveis para facilitar a identificação dos postos de combustíveis pelo usuário através de ícones nos postos de gasolina indicando as bandeiras dos postos. Outra necessidade observada durante o segundo período do projeto foram algumas informações fornecidas pela API do Google possuíam erros. Com o módulo de administração, é possível corrigir esses erros pontuais. Além disso, como a primeira versão do aplicativo que vai para a Play Store não irá possuir as funcionalidades que irão garantir a qualidade dos dados de preços dos combustíveis, mostrou-se importante ser possível editar os dados de sugestões de preço manualmente de forma mais prática. Viu-se também a importância de manter um controle na aplicação no que tange a controle de gastos do motorista e como isso age como um diferencial dos aplicativos atuais. 

No Anexo \ref{chap:telas} encontram-se algumas telas da aplicação desenvolvida.

\subsection{Método de decisão de postos boicotados}
Toda semana, serão selecionados postos onde os usuários serão incentivados a não abastecer. Para decidir quais postos serão boicotados, o Guimifiu tem duas estratégias principais: a \textbf{Lista Comum} e o \textbf{Boicote por Bandeiras}. A lista comum escolhe os postos que tenham uma qualidade geral menor que 1 e que não tenham sido boicotados recentemente e cria uma lista inicial. A qualidade geral de um posto é determinada pela fórmula a seguir onde são considerados o número de estrelas do posto e o preço dos combustíveis:

\begin{equation}
\label{Equação para cálculo de qualidade geral do Combustível}
	QG = \frac{5*QE}{2*(PG + PA + PD)}
\end{equation}

Sendo que QG é a Qualidade Geral do posto, PG, PA e PD são os preços de Gasolina, Álcool e Diesel, respectivamente e, por fim, QE é a Quantidade de Estrelas. A quantidade de estrelas é definida pela média das avaliações dos usuários. O objetivo é que a qualidade do posto indicado pelos usuários seja proporcional a qualidade geral dele e que os preços dos combustíveis sejam inversamente proporcionais, ou seja, quanto maior a quantidade de estrelas e menor o preço dos combustíveis, maior a qualidade geral do posto, diminuindo as chances do mesmo ser boicotado. Essa fórmula será balanceada de acordo com os dados dos postos e das avaliações dos usuários com o tempo. A tabela \ref{tab:exemplo} contém um exemplo de postos fictícios com preços, quantidade de estrelas e a qualidade geral para exemplificar.

\begin{table}[H]
\centering
\caption{Tabela de postos fictícios}
\label{tab:exemplo}
\begin{tabular}{|c|c|c|c|c|c|}\hline
\textbf{Posto} & \textbf{PG}   & \textbf{PA}   & \textbf{PD}   & \textbf{QE}  & \textbf{QG}   \\
\hline
1     & 4,00 & 3,00 & 4,00 & 2   & 0,45 \\ \hline
2     & 3,90 & 3,20 & 4,50 & 5   & 1,07 \\ \hline
3     & 4,00 & 3,50 & 3,70 & 4,5 & 1,00 \\ \hline
4     & 4,00 & 3,80 & 3,90 & 3,5 & 0,74 \\ \hline
5     & 4,00 & 3,80 & 3,90 & 4,5 & 0,96 \\ \hline
\end{tabular}
\end{table}

Na tabela \ref{tab:exemplo}, os postos 1, 4 e 5 seriam os postos colocados inicialmente na lista inicial por causa do seu QG baixo. O posto 2 e 3 estariam logo acima do limite mínimo e por isso estariam de fora da lista.

A lista inicial é montada e depois é verificado se não existem muitos postos perto demais sendo boicotados para não deixar o usuário com poucas opções de locais para abastecimento. Essa verificação é feita através de grafos. Os nós dos grafos são os postos de combustíveis e as arestas são as distâncias entre os todos postos que não sejam maiores que 10 quilômetros. Com este grafo, em cada nó da lista inicial é verificado se os nós adjacentes são todos postos que estão na lista inicial. Em caso positivo, o nó é removido da lista, caso contrário o nó é mantido. Os nós restantes compõem a lista final de postos boicotados, denominada \textbf{Lista Comum}. Na Figura \ref{img:listainicial}, considerando que os pontos vermelhos são nós da lista inicial e os pontos azuis são o resto dos postos, após a verificação, os pontos vermelhos virariam azuis como na Figura \ref{img:listacomum}.

\begin{figure}[H]
    \centering
    \includegraphics[scale=0.5]{figuras/listainicial.jpg}
    \caption[Grafo com Lista Inicial de Postos Boicotados]{Grafo com Lista Inicial de Postos Boicotados. Fonte: autores}
    \label{img:listainicial}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[scale=0.5]{figuras/listacomum.jpg}
    \caption[Grafo com Lista Comum de Postos Boicotados]{Grafo com Lista Comum de Postos Boicotados. Fonte: autores}
    \label{img:listacomum}
\end{figure}

O \textit{Boicote por Bandeiras} escolhe uma bandeira e todos os postos dessa bandeira são colocados na lista de boicotados, independentemente da distância entre eles, colocando o prejuízo do boicote menos nos postos e mais na bandeira. Os dois tipos de boicote são exclusivos, ou seja, os dois não ocorrem no mesmo período. A estratégia de boicote é escolhida pela equipe de desenvolvimento.  

\subsection{Testes Automatizados}

Foram feitos testes de integração e unitários para garantir o funcionamento dos métodos do código fonte e da integração da aplicação \textit{mobile} com a API.

Foi encontrada uma certa dificuldade pra realizar os testes unitários no Ionic, uma vez que não há muitos exemplos que de fato funcionam e uma documentação do próprio \textit{framework} sobre o assunto.

O código de testes pode ser encontrado no repositório da aplicação no GitHub (https://github.com/Guimifiu/guimifiu-app). Um exemplo de teste unitário e um de teste de integração está disponível no Anexo \ref{chap:testes}.

\subsection{Métricas de Código fonte}

Como citado no \autoref{chap:met}, foram utilizadas as ferramentas CodeClimate e Rubocop. Além de medir a complexidade no Rubocop, foi feita na integração contínua um relatório de métricas pela ferramenta que impede que a \textit{build} passe caso a complexidade seja maior do que 6, que é o padrão de complexidade ciclomática máxima aceitável.

A Figura \ref{img:rubocop} mostra o resultado da análise feita pelo Rubocop. O arquivo de configuração utilizado para a análise pode ser encontrado no endereço do Github do  \citeonline{rubocop-guimifiu}.

\begin{figure}[H]
    \centering
    \includegraphics[scale=0.5]{figuras/rubocop.png}
    \caption[Relatório de análise estática do Rubocop]{Relatório de análise estática do Rubocop. Fonte: autores}
    \label{img:rubocop}
\end{figure}

A Figura \ref{img:codeclimate} mostra o resultado das análises realizado pelo \href{https://codeclimate.com/github/Guimifiu/guimifiu-backend/}{CodeClimate}. 

\begin{figure}[H]
    \centering
    \includegraphics[scale=0.5]{figuras/codeclimate.png}
    \caption[Relatório de análise estática do CodeClimate]{Relatório de análise estática do CodeClimate. Fonte: autores}
    \label{img:codeclimate}
\end{figure}

Seis das sete \textit{issues} encontradas foram por motivo do CodeClimate utilizar um parser com uma versão menor do que a versão do Ruby utilizada pela equipe, enquanto a última foi uma duplicação de código que será tratada durante a segunda parte do trabalho.


\subsection{Integração e Entrega Contínua}
\input{editaveis/resultados/integracao-e-deploy-continuo}

